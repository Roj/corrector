{% extends "base.html" %}
{%block title %}
{{guia_actual}}
{% endblock %}
{% block content %}
  <form action="#" id="form_guia" onsubmit="enviarDatos(event)">
    {% for i in range(enunciados|length) %}
    <div class="card mt-4">
      <div class="card-body">
        <h3 class="card-title">Ejercicio {{i+1}}</h3>
        <p class="card-text">
          {{enunciados[i]}}
        </p>
        <pre class="topborder"><code class="python" onclick="$('#ej{{i}}code')[0].focus()">def ejercicio{{i+1}}(pd, datos):</code></pre>
        <pre><code class="python indented editor" contenteditable id="ej{{i}}code">//tu código va acá</code></pre>
        <pre><code class="python indented" onclick="$('#ej{{i}}code')[0].focus()">return datos</code></pre>
      </div>
    </div>
    {% endfor %}
    <input type="submit"
      class="btn btn-success" value="Enviar"/>
  </form>
{% endblock %}
{% block scripts %}
  <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
  <script language="javascript">
    hljs.initHighlightingOnLoad();
    $(document).on("focusout", "pre code.editor", function(event){
      editors = $("pre code.editor");
      for(i = 0; i < editors.length; i++)
        hljs.highlightBlock(editors[i]);
    });
    function enviarDatos(event) {
      event.preventDefault();
      console.log("Funcion llamada!");
      codigos = [];
      for(i = 0; i < $("pre code.editor").length; i++) {
        codigos.push($("#ej"+i+"code")[0].innerText);
        console.log($("#ej"+i+"code")[0].innerText);
      }
      $.ajax({
        url: "/guia/{{guia_actual}}/entregar",
        type: "POST",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data: JSON.stringify(codigos),
        success: console.log,
        error: console.log
      })
    }
  </script>
{% endblock %}
